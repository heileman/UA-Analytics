<<<<<<< HEAD
<!DOCTYPE html>
<html>

<script src="./jquery/dist/jquery.min.js"></script>
<script src="./d3/d3.min.js"></script>
<script src="./ad.min.js"></script>
<link rel="stylesheet" type="text/css" href="./ad.css" />
<script>
	$(document).ready(function(){

		var sankeyChart = new AD.CHARTS.sankeyChart();

		sankeyChart
			.nodePadding(20)
			.layout(0)
			// .select('.sankey-chart')
			// .width($(window).width())
			// .height($(window).height())
			.xFormat({siPrefixed:true,separateThousands:false,units:{before:"$"},precision:4});

		data = {
						labels:{source:"Income = $2.58B ",destination:"Expenditures = $2.58B"},
						columnHeaders:["Source of Funds","Use of Funds"],

						nodes:[
							//Source Nodes
							{id:0,name:"Financial Aid Grants",shortName:"Financial Aid Grants",colorKey:"Financial Aid Grants"},
							{id:1,name:"Tuition and Fees",shortName:"Tuition and Fees",colorKey:"Tuition and Fees"},
							{id:2,name:"State General Fund",shortName:"State General Fund",colorKey:"State General Fund"},
							{id:3,name:"Sales, Service & Designated Contracts",shortName:"Sales, Service & Designated Contracts",colorKey:"Sales, Service & Designated Contracts"},
							{id:4,name:"Sponsored Grants & Contracts",shortName:"Sponsored Grants & Contracts",colorKey:"Sponsored Grants & Contracts"},
							{id:5,name:"F&A on Sponsored Grants & Contracts",shortName:"F&A on Sponsored Grants & Contracts",colorKey:"F&A on Sponsored Grants & Contracts"},
							{id:6,name:"Other Revenue",shortName:"Other Revenue",colorKey:"Other Revenue"},
							{id:7,name:"Auxiliaries",shortName:"Auxiliaries",colorKey:"Auxiliaries"},

							//Use Nodes
							{id:8,name:"Student Financial Aid",shortName:"Student Financial Aid",colorKey:"Student Financial Aid"},
							{id:9,name:"Faculty Salaries",shortName:"Faculty Salaries",colorKey:"Faculty Salaries"},
							{id:10,name:"Non-faculty College Staff and Operations",shortName:"Non-faculty College Staff and Operations",colorKey:"Non-faculty College Staff and Operations"},
							{id:11,name:"Support Unit Staff and Operations/Institutional Costs",shortName:"Support Unit Staff and Operations/Institutional Costs",colorKey:"Support Unit Staff and Operations/Institutional Costs"},
							{id:12,name:"Debt Service",shortName:"Debt Service",colorKey:"Debt Service"},
							{id:13,name:"Auxiliary Unit Staff and Operations",shortName:"Auxiliary Unit Staff and Operations",colorKey:"Auxiliary Unit Staff and Operations"}

						],

						links:[
							//Source to Use1 Flow
							{source:0, target:8, value:56800000, colorBy:"source"},

							{source:1, target:8, value:209600000, colorBy:"source"},
							{source:1, target:9, value:179705400, colorBy:"source"},
							{source:1, target:10, value:245739200, colorBy:"source"},
							{source:1, target:11, value:224474200, colorBy:"source"},
							{source:1, target:12, value:43128900, colorBy:"source"},
							{source:1, target:13, value:11471300, colorBy:"source"},

							{source:2, target:8, value:2729400, colorBy:"source"},
							{source:2, target:9, value:74060500, colorBy:"source"},
							{source:2, target:10, value:91738400, colorBy:"source"},
							{source:2, target:11, value:99165700, colorBy:"source"},
							{source:2, target:12, value:25013000, colorBy:"source"},

							{source:3, target:9, value:53618700, colorBy:"source"},
							{source:3, target:10, value:83986300, colorBy:"source"},
							{source:3, target:11, value:163095000, colorBy:"source"},

							{source:4, target:9, value:31416300, colorBy:"source"},
							{source:4, target:10, value:424583700, colorBy:"source"},

							{source:5, target:9, value:2237600, colorBy:"source"},
							{source:5, target:10, value:37747400, colorBy:"source"},
							{source:5, target:11, value:55792900, colorBy:"source"},
							{source:5, target:12, value:8222100, colorBy:"source"},

							{source:6, target:9, value:38054100, colorBy:"source"},
							{source:6, target:10, value:59606600, colorBy:"source"},
							{source:6, target:11, value:27339300, colorBy:"source"},
							{source:6, target:12, value:4200000, colorBy:"source"},

							{source:7, target:11, value:16482000, colorBy:"source"},
							{source:7, target:12, value:26800000, colorBy:"source"},
							{source:7, target:13, value:279918000, colorBy:"source"}

						]
				};

		var chartLayoutData = {
			chartLayout:{
				title:"University of Arizona - Flow of Funds"
			},
			// chartData:{data:data}
		}
		sankeyChart.data({data:data})
		var chartLayout = new AD.UTILS.CHARTPAGE.chartLayout();

		chartLayout
			.select('.sankey-chart')
			//.width($(window).width())
			// .height($(window).height())
			.height(1000)
			.width(1500)
			.data({data:chartLayoutData})
			.chart(sankeyChart);


		chartLayout.update();

		// $(window).resize(function(){
		// 	chartLayout.height($(window).height()).width($(window).width()).update();
		// });

	})
</script>
<style>
	.ad-general-tooltip{
		/*display:none !important;*/
	}
	.tab { margin-left: 40px; }
</style>

<body style='margin:0px;'>
<div class = 'sankey-chart'></div>
<div>
<p class="tab">
	Note: Data presented is a budgeted funds flow representation of university sources and uses and does not reflect Comprehensive Annual Financial Report (CAFR)
</p>
</div>

</body>
</html>
=======

THIS IS STILL IN PROGRESS!
Trying to create a diagram which highlights. 

<!DOCTYPE html>
<html>
<meta charset="utf-8">
<title>Sankey Diagram</title>
<style>
 
@import url(http://fonts.googleapis.com/css?family=PT+Serif|PT+Serif:b|PT+Serif:i|PT+Sans|PT+Sans:b);
 
#chart {
  height: 500px;
}
 
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}
 
.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}
 
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
 
.link:hover {
  stroke-opacity: .5 !important;
}
 
</style>
<body>

<div id="chart"></div>

<script src="https://d3js.org/d3.v3.min.js?2.9.1"></script>
<script src="sankey.js"></script>
<script>
 
var margin = {top: 1, right: 1, bottom: 6, left: 1},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
 
var formatNumber = d3.format(",.0f"),
    format = function(d) { return formatNumber(d) + " TWh"; },
    color = d3.scale.category20();
 
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
 
var sankey = d3.sankey()
    .nodeWidth(15)
    .nodePadding(10)
    .size([width, height]);
 
var path = sankey.link();
 


data = {
			labels:{source:"Income = $2.58B ",destination:"Expenditures = $2.58B"},
			columnHeaders:["Source of Funds","Summary Use of Funds", "Deatiled Use of Funds"],

			nodes:[
				//Source Nodes
				{id:0,name:"Financial Aid Grants",shortName:"Financial Aid Grants",colorKey:"Financial Aid Grants"},
				{id:1,name:"Tuition and Fees",shortName:"Tuition and Fees",colorKey:"Tuition and Fees"},
				{id:2,name:"State General Fund",shortName:"State General Fund",colorKey:"State General Fund"},
				{id:3,name:"Sales, Service & Designated Contracts",shortName:"Sales, Service & Designated Contracts",colorKey:"Sales, Service & Designated Contracts"},
				{id:4,name:"Sponsored Grants & Contracts",shortName:"Sponsored Grants & Contracts",colorKey:"Sponsored Grants & Contracts"},
				{id:5,name:"F&A on Sponsored Grants & Contracts",shortName:"F&A on Sponsored Grants & Contracts",colorKey:"F&A on Sponsored Grants & Contracts"},
				{id:6,name:"Other Revenue",shortName:"Other Revenue",colorKey:"Other Revenue"},
				{id:7,name:"Auxiliaries",shortName:"Auxiliaries",colorKey:"Auxiliaries"},

				//Use1 Nodes
				{id:8,name:"Student Financial Aid",shortName:"Student Financial Aid",colorKey:"Student Financial Aid"},
				{id:9,name:"Colleges 'State Line'",shortName:"Colleges 'State Line'",colorKey:"Colleges 'State Line'"},
				{id:10,name:"Colleges Other Revenues",shortName:"Colleges Other Revenues",colorKey:"Colleges Other Revenues"},
				{id:11,name:"Sponsored Grants & Contracts",shortName:"Sponsored Grants & Contracts",colorKey:"Sponsored Grants & Contracts"},
				{id:12,name:"Support Units & Institution",shortName:"Support Units & Institution",colorKey:"Support Units & Institution"},
				{id:13,name:"Debt Service",shortName:"Debt Service",colorKey:"Debt Service"},
				{id:14,name:"Auxiliaries",shortName:"Auxiliaries",colorKey:"Auxiliaries"},

				//Use2 Nodes
				{id:15,name:"Student Financial Aid",shortName:"Student Financial Aid",colorKey:"Student Financial Aid"},
				{id:16,name:"Faculty Salaries",shortName:"Faculty Salaries",colorKey:"Faculty Salaries"},
				{id:17,name:"Non-faculty College Staff and Operations",shortName:"Non-faculty College Staff and Operations",colorKey:"Non-faculty College Staff and Operations"},
				{id:18,name:"Support Unit Staff and Operations/Institutional Costs",shortName:"Support Unit Staff and Operations/Institutional Costs",colorKey:"Support Unit Staff and Operations/Institutional Costs"},
				{id:19,name:"Debt Service",shortName:"Debt Service",colorKey:"Debt Service"},
				{id:20,name:"Auxiliary Unit Staff and Operations",shortName:"Auxiliary Unit Staff and Operations",colorKey:"Auxiliary Unit Staff and Operations"}

			],

			links:[
				//Source to Use1 Flow
				{source:0, target:8, value:56800000, colorBy:"source"},

				{source:1, target:8, value:209600000, colorBy:"source"},
				{source:1, target:9, value:341117100, colorBy:"source"},
				{source:1, target:10, value:84327500, colorBy:"source"},
				{source:1, target:12, value:224474200, colorBy:"source"},
				{source:1, target:13, value:43128900, colorBy:"source"},
				{source:1, target:14, value:11471300, colorBy:"source"},

				{source:2, target:8, value:2729400, colorBy:"source"},
				{source:2, target:9, value:165798900, colorBy:"source"},
				{source:2, target:12, value:99165700, colorBy:"source"},
				{source:2, target:13, value:25013000, colorBy:"source"},

				{source:3, target:10, value:137605000, colorBy:"source"},
				{source:3, target:12, value:163095000, colorBy:"source"},

				{source:4, target:11, value:456000000, colorBy:"source"},

				{source:5, target:10, value:39985000, colorBy:"source"},
				{source:5, target:12, value:55792900, colorBy:"source"},
				{source:5, target:13, value:8222100, colorBy:"source"},

				{source:6, target:10, value:97660700, colorBy:"source"},
				{source:6, target:12, value:27339300, colorBy:"source"},
				{source:6, target:13, value:4200000, colorBy:"source"},

				{source:7, target:12, value:16482000, colorBy:"source"},
				{source:7, target:13, value:26800000, colorBy:"source"},
				{source:7, target:14, value:279918000, colorBy:"source"},

				//Use1 to Use2 Flow
				{source:8, target:15, value:269129400, colorBy:"source"},

				{source:9, target:16, value:226433500, colorBy:"source"},
				{source:9, target:17, value:280482500, colorBy:"source"},

				{source:10, target:16, value:121242800, colorBy:"source"},
				{source:10, target:17, value:238332400, colorBy:"source"},

				{source:11, target:16, value:31416300, colorBy:"source"},
				{source:11, target:17, value:424583700, colorBy:"source"},

				{source:12, target:18, value:586349100, colorBy:"source"},

				{source:13, target:19, value:107364000, colorBy:"source"},

				{source:14, target:20, value:291389300, colorBy:"source"}

			]
		};







sankey
  .nodes(data.nodes)
  .links(data.links)
  .layout(32);

var link = svg.append("g").selectAll(".link")
  .data(data.links)
.enter().append("path")
  .attr("class", "link")
  .attr("d", path)
  .attr("id", function(d,i){
    d.id = i;
    return "link-"+i;
  })
  .style("stroke-width", function(d) { return Math.max(1, d.dy); })
  .sort(function(a, b) { return b.dy - a.dy; });

link.append("title")
  .text(function(d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

var node = svg.append("g").selectAll(".node")
  .data(data.nodes)
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
  .on("click",highlight_node_links)
.call(d3.behavior.drag()
  .origin(function(d) { return d; })
  // interfering with click .on("dragstart", function() { this.parentNode.appendChild(this); })
  .on("drag", dragmove));

node.append("rect")
  .attr("height", function(d) { return d.dy; })
  .attr("width", sankey.nodeWidth())
  .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
  .style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
.append("title")
  .text(function(d) { return d.name + "\n" + format(d.value); });

node.append("text")
  .attr("x", -6)
  .attr("y", function(d) { return d.dy / 2; })
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .attr("transform", null)
  .text(function(d) { return d.name; })
.filter(function(d) { return d.x < width / 2; })
  .attr("x", 6 + sankey.nodeWidth())
  .attr("text-anchor", "start");

function dragmove(d) {
	
	d3.select(this).attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
	sankey.relayout();
	link.attr("d", path);

}

function highlight_node_links(node,i){

	var remainingNodes=[],
	    nextNodes=[];

	var stroke_opacity = 0;
	if( d3.select(this).attr("data-clicked") == "1" ){
	  d3.select(this).attr("data-clicked","0");
	  stroke_opacity = 0.2;
	}else{
	  d3.select(this).attr("data-clicked","1");
	  stroke_opacity = 0.5;
	}

	var traverse = [{
	                  linkType : "sourceLinks",
	                  nodeType : "target"
	                },{
	                  linkType : "targetLinks",
	                  nodeType : "source"
	                }];

	traverse.forEach(function(step){
	  node[step.linkType].forEach(function(link) {
	    remainingNodes.push(link[step.nodeType]);
	    highlight_link(link.id, stroke_opacity);
	  });

	  while (remainingNodes.length) {
	    nextNodes = [];
	    remainingNodes.forEach(function(node) {
	      node[step.linkType].forEach(function(link) {
	        nextNodes.push(link[step.nodeType]);
	        highlight_link(link.id, stroke_opacity);
	      });
	    });
	    remainingNodes = nextNodes;
	  }
	});
}

function highlight_link(id,opacity){
  d3.select("#link-"+id).style("stroke-opacity", opacity);
}
 
</script>












>>>>>>> 6dbf24280523e3ecdbca54e0acd6c5a8f2c0b47b
